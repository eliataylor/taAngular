;facebookConnectPlugin.perm2Fields={public_profile:{req:!1,fields:'id,name,gender,timezone,age_range,verified'},email:{req:!0,fields:'email'},user_birthday:{req:!1,fields:'birthday'},user_photos:{req:!1,fields:'cover,albums,photos'}};facebookConnectPlugin.fbPerms=['email'];facebookConnectPlugin.fbFailed=function(e){tautils.tracer(e,'ERROR: facebookConnectPlugin');if(typeof e=='object'){if(typeof e.status=='string')e=e.status;else if(typeof e.errorMessage=='string')e=e.errorMessage};$('#pagePreloader').fadeOut('fast');tautils.showNotice(e)};facebookConnectPlugin.fbSync=function(e){tautils.showPagePreloader(!0);facebookConnectPlugin.getLoginStatus(function(e){if(e.status==='connected'){facebookConnectPlugin.checkPerms(e)}
else{tautils.tracer(e,'WARN: NOT connected getLoginStatus');facebookConnectPlugin.login(facebookConnectPlugin.fbPerms,function(e){if(e.status==='connected'){facebookConnectPlugin.checkPerms(e)}
else{tautils.tracer(e)}},facebookConnectPlugin.fbFailed)}},facebookConnectPlugin.fbFailed)};facebookConnectPlugin.fbUpgrade=function(e){tautils.showPagePreloader(!0);if(!e)e=facebookConnectPlugin.fbPerms;facebookConnectPlugin.login(e,function(e){if(e.status==='connected'){facebookConnectPlugin.checkPerms(e)}
else{tautils.showNotice('Extended permissions rejected');tautils.tracer(e)}},facebookConnectPlugin.fbFailed)};facebookConnectPlugin.checkPerms=function(e){tautils.tracer(e,'INFO: checking fb perms');if(typeof e.authResponse=='object'&&typeof e.authResponse.accessToken){CUR_VISITOR_FB_TOKEN=e.authResponse.accessToken};facebookConnectPlugin.api('/me/permissions',null,function(e){tautils.tracer(e,'INFO: permissions');var o=[],a=[],s=[],c=[];for(var n in e.data){if(typeof facebookConnectPlugin.perm2Fields[e.data[n].permission]=='undefined'){continue};var i=facebookConnectPlugin.perm2Fields[e.data[n].permission];facebookConnectPlugin.perm2Fields[e.data[n].permission].status=e.data[n].status;if(e.data[n].status!='granted'&&i.req==!0){o.push(e.data[n].permission)}
else if(e.data[n].status!='granted'){varned=a.concat(i.fields.split(','))}
else{c.push(e.data[n].permission);s=s.concat(i.fields.split(','))}};facebookConnectPlugin.fbPerms=c;if(o.length===0){facebookConnectPlugin.syncServer();if(a.length>0){var r=a.join(', ').replace(/_/ig,' '),t='you must approve these permissions to take this action: '+r;tautils.showNotice(t);return!1}}
else{var t='You must approve the following permissions: '+o.join(', ');tautils.tracer(e,'WARN: '+t);facebookConnectPlugin.fbUpgrade(o)}},facebookConnectPlugin.fbFailed)};facebookConnectPlugin.syncServer=function(e){if(e){CUR_VISITOR_FB_TOKEN=e};$.ajax({crossDomain:!0,type:'POST',data:{'fb_access_token':CUR_VISITOR_FB_TOKEN},url:'/manage/users/login?tar=doAjax'}).done(function(e){CUR_VISITOR=parseInt(e.user_id);CUR_GROUP=parseInt(e.group_id);if(CUR_VISITOR){if(typeof e.redirect=='string')document.location.href=e.redirect;else document.location.href='/dashboard'}
else{tautils.showNotice('FB login Failed')};$('#pagePreloader').fadeOut('fast')})};facebookConnectPlugin.syncClient=function(e,n){facebookConnectPlugin.api('/me?fields='+e.join(','),n,function(n){tautils.tracer(n,'INFO: syncClient user');tautils.tracer(e,'INFO: syncClient fields');CUR_VISITOR=n.id})};